<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>av_quant v5.1</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Hiragino Kaku Gothic ProN","Yu Gothic","Noto Sans JP",Arial,sans-serif;
  background:#f7f7f9;
}
.wrap{max-width:960px;margin:16px auto;padding:16px}
.card{background:#fff;border-radius:12px;padding:14px;margin-bottom:12px;box-shadow:0 1px 3px rgba(0,0,0,.06)}
button{padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
.btn{background:#0b66ff;color:#fff}
.btn.ghost{background:#fff;color:#0b66ff;border:1px solid #0b66ff}
.btn.danger{background:#e5533d;color:#fff}
.screen{display:none}
.screen.active{display:block}
input,select,textarea{padding:8px;border-radius:8px;border:1px solid #ccc;font-size:14px}
textarea{width:100%;min-height:160px}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #eee;text-align:center}
th{background:#fafafa}

.chartWrap{
  display:flex;
  gap:24px;
  align-items:center;
}
.chartBox{
  width:360px;
  height:360px;
}
.metricBox{
  font-size:16px;
  line-height:2;
}
.metricBox div{
  font-weight:600;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
<div class="wrap">

<div class="card">
<button class="btn" data-screen="ranking">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</button>
<button class="btn" data-screen="add">è¿½åŠ </button>
<button class="btn" data-screen="edit">ç·¨é›†</button>
<button class="btn" data-screen="io">CSV</button>
</div>

<section id="ranking" class="card screen active">
<h2>ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
<select id="sortSelect">
<option value="view">è¦–ç•Œåˆ¶åœ§åŠ›</option>
<option value="mind">å¿ƒç†çš„å¼•åŠ›</option>
<option value="lust">ç…½æƒ…æ’å¸¸åŠ›</option>
</select>
<table>
<thead>
<tr>
<th>é †ä½</th><th>åå‰</th>
<th>è¦–ç•Œ</th><th>å¿ƒç†</th><th>ç…½æƒ…</th>
<th>æ“ä½œ</th>
</tr>
</thead>
<tbody id="rankingBody"></tbody>
</table>
</section>

<section id="add" class="card screen">
<h2>è¿½åŠ </h2>
<input id="add_name" placeholder="åå‰"><br><br>
é¡”<input id="add_face" type="number"><br>
èº«ä½“<input id="add_body" type="number"><br>
æ¼”æŠ€<input id="add_acting" type="number"><br>
æŠœã‘åº¦<input id="add_nuke" type="number"><br>
å®‰å®šæ„Ÿ<input id="add_stable" type="number"><br><br>
<button class="btn" id="addBtn">è¿½åŠ </button>
</section>

<section id="edit" class="card screen">
<h2>ç·¨é›†</h2>
<select id="edit_select"></select><br><br>
<input id="edit_name"><br>
é¡”<input id="edit_face" type="number"><br>
èº«ä½“<input id="edit_body" type="number"><br>
æ¼”æŠ€<input id="edit_acting" type="number"><br>
æŠœã‘åº¦<input id="edit_nuke" type="number"><br>
å®‰å®šæ„Ÿ<input id="edit_stable" type="number"><br><br>
<button class="btn" id="saveBtn">æ›´æ–°</button>
<button class="btn danger" id="delBtn">å‰Šé™¤</button>
</section>

<section id="io" class="card screen">
<h2>CSVå…¥å‡ºåŠ›</h2>
<textarea id="csvText"></textarea><br><br>
<button class="btn" id="importBtn">è¿½è¨˜èª­ã¿è¾¼ã¿</button>
<button class="btn ghost" id="exportBtn">æ›¸ãå‡ºã—</button>
</section>

<section id="chart" class="card screen">
<h2 id="chartTitle"></h2>
<div class="chartWrap">
  <div class="chartBox">
    <canvas id="radar"></canvas>
  </div>
  <div class="metricBox">
    <div>è¦–ç•Œåˆ¶åœ§åŠ›ï¼š<span id="cv"></span></div>
    <div>å¿ƒç†çš„å¼•åŠ›ï¼š<span id="cm"></span></div>
    <div>ç…½æƒ…æ’å¸¸åŠ›ï¼š<span id="cl"></span></div>
  </div>
</div>
<br>
<button class="btn ghost" data-screen="ranking">æˆ»ã‚‹</button>
</section>

</div>

<script>
const KEY="av_quant_v51";
const screens=document.querySelectorAll(".screen");

function show(id){
  screens.forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}
document.querySelectorAll("[data-screen]").forEach(b=>{
  b.onclick=()=>show(b.dataset.screen);
});

function load(){return JSON.parse(localStorage.getItem(KEY)||"[]")}
function save(d){localStorage.setItem(KEY,JSON.stringify(d))}

function calc(a){
  a.view=Math.floor(a.body*1.5+a.nuke*1.25+a.acting*1+a.face*0.75+a.stable*0.5);
  a.mind=Math.floor(a.acting*1.5+a.nuke*1.25+a.face*1+a.body*0.75+a.stable*0.5);
  a.lust=Math.floor(a.stable*1.5+a.face*1.25+a.acting*1+a.body*0.75+a.nuke*0.5);
}

function render(){
  const body=document.getElementById("rankingBody");
  body.innerHTML="";
  const data=load();
  const mode=sortSelect.value;
  data.forEach(calc);
  data.sort((a,b)=>b[mode]-a[mode]);
  data.forEach((a,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${i+1}</td><td>${a.name}</td>
      <td>${a.view}</td><td>${a.mind}</td><td>${a.lust}</td>
      <td><button onclick="openChart('${a.id}')">ğŸ“Š</button></td>`;
    body.appendChild(tr);
  });
  renderEdit();
}

function openChart(id){
  const a=load().find(x=>x.id===id);
  if(!a)return;
  calc(a);
  show("chart");
  chartTitle.textContent=a.name;
  cv.textContent=a.view;
  cm.textContent=a.mind;
  cl.textContent=a.lust;

  if(window.radarChart) radarChart.destroy();
  radarChart=new Chart(radar,{
    type:"radar",
    data:{
      labels:["é¡”","èº«ä½“","æ¼”æŠ€","æŠœã‘åº¦","å®‰å®šæ„Ÿ"],
      datasets:[{
        data:[a.face,a.body,a.acting,a.nuke,a.stable],
        fill:true
      }]
    },
    options:{
      scales:{
        r:{
          min:0,
          max:100,
          ticks:{stepSize:20}
        }
      }
    }
  });
}

addBtn.onclick=()=>{
  const d=load();
  d.push({
    id:Date.now().toString(),
    name:add_name.value,
    face:+add_face.value||0,
    body:+add_body.value||0,
    acting:+add_acting.value||0,
    nuke:+add_nuke.value||0,
    stable:+add_stable.value||0
  });
  save(d);render();show("ranking");
};

function renderEdit(){
  edit_select.innerHTML="";
  load().forEach(a=>{
    const o=document.createElement("option");
    o.value=a.id;o.textContent=a.name;
    edit_select.appendChild(o);
  });
}

edit_select.onchange=()=>{
  const a=load().find(x=>x.id===edit_select.value);
  if(!a)return;
  edit_name.value=a.name;
  edit_face.value=a.face;
  edit_body.value=a.body;
  edit_acting.value=a.acting;
  edit_nuke.value=a.nuke;
  edit_stable.value=a.stable;
};

saveBtn.onclick=()=>{
  const d=load();
  const i=d.findIndex(x=>x.id===edit_select.value);
  if(i<0)return;
  Object.assign(d[i],{
    name:edit_name.value,
    face:+edit_face.value,
    body:+edit_body.value,
    acting:+edit_acting.value,
    nuke:+edit_nuke.value,
    stable:+edit_stable.value
  });
  save(d);render();show("ranking");
};

delBtn.onclick=()=>{
  save(load().filter(x=>x.id!==edit_select.value));
  render();show("ranking");
};

importBtn.onclick=()=>{
  const lines=csvText.value.trim().split("\n");
  const d=load();
  for(let i=1;i<lines.length;i++){
    const c=lines[i].split(",");
    if(c.length<6)continue;
    d.push({
      id:Date.now()+""+i,
      name:c[0],
      face:+c[1],body:+c[2],acting:+c[3],nuke:+c[4],stable:+c[5]
    });
  }
  save(d);render();show("ranking");
};

exportBtn.onclick=()=>{
  let t="åå‰,é¡”,èº«ä½“,æ¼”æŠ€,æŠœã‘åº¦,å®‰å®šæ„Ÿ\n";
  load().forEach(a=>{
    t+=`${a.name},${a.face},${a.body},${a.acting},${a.nuke},${a.stable}\n`;
  });
  csvText.value=t;
};

sortSelect.onchange=render;
render();
</script>
</body>
</html>
