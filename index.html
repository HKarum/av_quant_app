<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>av_quant</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{margin:0;font-family:sans-serif;background:#f5f5f7}
.wrap{max-width:1100px;margin:auto;padding:16px}
header{display:flex;justify-content:space-between;align-items:center}
button{padding:8px 12px;border-radius:6px;border:none;cursor:pointer}
.card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;margin-top:16px}
.card{background:#fff;border-radius:10px;padding:12px;box-shadow:0 2px 5px rgba(0,0,0,.08)}
.card h3{margin:0 0 8px 0}
.score{font-size:13px}
.memo{margin-top:8px;font-size:12px;color:#555}
.actions{margin-top:8px;display:flex;gap:6px}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center}
.modal-content{background:#fff;border-radius:10px;padding:16px;max-width:700px;width:100%}
input,textarea{width:100%;margin-bottom:6px;padding:6px}
.hidden{display:none}
</style>
</head>
<body>

<div class="wrap">
<header>
<h1>av_quant</h1>
<div>
<button onclick="openEditor()">è¿½åŠ </button>
<button onclick="openCSV()">CSV</button>
</div>
</header>

<select id="sort" onchange="render()">
<option value="shikai">è¦–ç•Œåˆ¶åœ§åŠ›</option>
<option value="shinri">å¿ƒç†çš„å¼•åŠ›</option>
<option value="jousei">ç…½æƒ…æ’å¸¸åŠ›</option>
</select>

<div id="cards" class="card-grid"></div>
</div>

<!-- ç·¨é›† -->
<div id="editor" class="modal">
<div class="modal-content">
<h2 id="editTitle"></h2>
<input id="name" placeholder="åå‰">
<input type="number" id="face" placeholder="é¡”">
<input type="number" id="body" placeholder="èº«ä½“">
<input type="number" id="acting" placeholder="æ¼”æŠ€">
<input type="number" id="nuke" placeholder="æŠœã‘åº¦">
<input type="number" id="stable" placeholder="å®‰å®šæ„Ÿ">
<textarea id="memo" placeholder="è©•ä¾¡ãƒ¡ãƒ¢"></textarea>
<button onclick="save()">ä¿å­˜</button>
<button onclick="closeEditor()">é–‰ã˜ã‚‹</button>
</div>
</div>

<!-- ãƒ¬ãƒ¼ãƒ€ãƒ¼ -->
<div id="radarModal" class="modal">
<div class="modal-content">
<canvas id="radar"></canvas>
<div id="powers"></div>
<button onclick="closeRadar()">é–‰ã˜ã‚‹</button>
</div>
</div>

<!-- CSV -->
<div id="csvModal" class="modal">
<div class="modal-content">
<textarea id="csv"></textarea>
<button onclick="importCSV()">å–è¾¼</button>
<button onclick="exportCSV()">å‡ºåŠ›</button>
<button onclick="closeCSV()">é–‰ã˜ã‚‹</button>
</div>
</div>

<script>
const KEY="av_quant_v5";
let data=JSON.parse(localStorage.getItem(KEY)||"[]");
let editing=null;

const W=[1.5,1.3,1.1,0.7,0.3];

function calc(o,order){
return Math.round(
order.map((k,i)=>o[k]*W[i]).reduce((a,b)=>a+b,0)
);
}

function powers(o){
return{
shikai:calc(o,["body","nuke","acting","face","stable"]),
shinri:calc(o,["acting","nuke","face","body","stable"]),
jousei:calc(o,["stable","nuke","acting","face","body"])
};
}

function render(){
const s=document.getElementById("sort").value;
cards.innerHTML="";
data.sort((a,b)=>powers(b)[s]-powers(a)[s]);
data.forEach(d=>{
const p=powers(d);
cards.innerHTML+=`
<div class="card">
<h3>${d.name}</h3>
<div class="score">è¦–ç•Œåˆ¶åœ§åŠ› ${p.shikai}</div>
<div class="score">å¿ƒç†çš„å¼•åŠ› ${p.shinri}</div>
<div class="score">ç…½æƒ…æ’å¸¸åŠ› ${p.jousei}</div>
<div class="memo">${d.memo||""}</div>
<div class="actions">
<button onclick="showRadar('${d.id}')">ğŸ“Š</button>
<button onclick="edit('${d.id}')">âœ</button>
<button onclick="del('${d.id}')">âœ•</button>
</div>
</div>`;
});
}

function save(){
const o={
id:editing||Date.now().toString(),
name:name.value,
face:+face.value,
body:+body.value,
acting:+acting.value,
nuke:+nuke.value,
stable:+stable.value,
memo:memo.value
};
if(editing){
data=data.map(d=>d.id===o.id?o:d);
}else data.push(o);
localStorage.setItem(KEY,JSON.stringify(data));
closeEditor();render();
}

function edit(id){
const d=data.find(x=>x.id===id);
editing=id;
editTitle.textContent="ç·¨é›†";
Object.assign(window,d);
openEditor();
}

function del(id){
data=data.filter(d=>d.id!==id);
localStorage.setItem(KEY,JSON.stringify(data));
render();
}

function openEditor(){editor.style.display="flex"}
function closeEditor(){editor.style.display="none";editing=null}

function showRadar(id){
const d=data.find(x=>x.id===id);
const ctx=radar.getContext("2d");
new Chart(ctx,{type:"radar",data:{labels:["é¡”","èº«ä½“","æ¼”æŠ€","æŠœã‘åº¦","å®‰å®šæ„Ÿ"],datasets:[{data:[d.face,d.body,d.acting,d.nuke,d.stable]}]},options:{scales:{r:{min:0,max:100}}}});
const p=powers(d);
powers.innerHTML=`è¦–ç•Œåˆ¶åœ§åŠ› ${p.shikai}<br>å¿ƒç†çš„å¼•åŠ› ${p.shinri}<br>ç…½æƒ…æ’å¸¸åŠ› ${p.jousei}`;
radarModal.style.display="flex";
}

function closeRadar(){radarModal.style.display="none"}

function openCSV(){csvModal.style.display="flex"}
function closeCSV(){csvModal.style.display="none"}

function exportCSV(){
csv.value="åå‰,é¡”,èº«ä½“,æ¼”æŠ€,æŠœã‘åº¦,å®‰å®šæ„Ÿ,ãƒ¡ãƒ¢\n"+
data.map(d=>[d.name,d.face,d.body,d.acting,d.nuke,d.stable,(d.memo||"")].join(",")).join("\n");
}
function importCSV(){
const l=csv.value.trim().split("\n").slice(1);
l.forEach(r=>{
const[c,f,b,a,n,s,m]=r.split(",");
data.push({id:Date.now()+Math.random()+"",name:c,face:+f,body:+b,acting:+a,nuke:+n,stable:+s,memo:m});
});
localStorage.setItem(KEY,JSON.stringify(data));
closeCSV();render();
}

render();
</script>
</body>
</html>
